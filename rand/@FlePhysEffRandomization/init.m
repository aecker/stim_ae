function r = init(r,varargin)
% AE 2008-09-03

% parameters which are randomized
r.conditions = struct('isFlash',{},'isMoving',{},'isStop',{}, ...
    'flashLocation',{},'barColor',{},'trajectoryAngle',{}, ...
    'direction',{},'dx',{},'arrangement',{});

%% Flashed and moving bars presented individually
%   In this case we present them both in the receptive fields of the neurons
if ~r.combined
    for i = 1:size(r.barColor,2)
        for angle = r.trajectoryAngle

            % flashes
            nLocs = r.numFlashLocs;
            r.conditions(end+(1:nLocs)) = ...
                struct('isFlash',1, ...
                       'isMoving',0, ...
                       'isStop',0, ...
                       'flashLocation',mat2cell(1:nLocs,1,ones(1,nLocs)), ...
                       'barColor',r.barColor(:,i), ...
                       'trajectoryAngle',angle, ...
                       'direction',NaN, ...
                       'dx',NaN, ...
                       'arrangement',1);

            % moving bars
            for dx = r.dx
                for dir = r.direction
                    r.conditions(end+1) = ...
                        struct('isFlash',0, ...
                               'isMoving',1, ...
                               'isStop',0, ...
                               'flashLocation',NaN, ...
                               'barColor',r.barColor(:,i), ...
                               'trajectoryAngle',angle, ...
                               'direction',dir, ...
                               'dx',dx, ...
                               'arrangement',0);
                    if r.flashStop
                        r.conditions(end+(1:nLocs)) = ...
                            struct('isFlash',0, ...
                                   'isMoving',1, ...
                                   'isStop',1, ...
                                   'flashLocation',mat2cell(1:nLocs,1,ones(1,nLocs)), ...
                                   'barColor',r.barColor(:,i), ...
                                   'trajectoryAngle',angle, ...
                                   'direction',dir, ...
                                   'dx',dx, ...
                                   'arrangement',0);
                    end
                end
            end
        end
    end
else
    for i = 1:size(r.barColor,2)
        for angle = r.trajectoryAngle
            for arr = r.arrangement

                % flashes
                nLocs = r.numFlashLocs;
                r.conditions(end+(1:nLocs)) = ...
                    struct('isFlash',1, ...
                           'isMoving',0, ...
                           'isStop',0, ...
                           'flashLocation',mat2cell(1:nLocs,1,ones(1,nLocs)), ...
                           'barColor',r.barColor(:,i), ...
                           'trajectoryAngle',angle, ...
                           'direction',NaN, ...
                           'dx',NaN, ...
                           'arrangement',arr);

                for dx = r.dx
                    for dir = r.direction
                        
                        % moving bars without flash
                        r.conditions(end+1) = ...
                            struct('isFlash',0, ...
                                   'isMoving',1, ...
                                   'isStop',0, ...
                                   'flashLocation',NaN, ...
                                   'barColor',r.barColor(:,i), ...
                                   'trajectoryAngle',angle, ...
                                   'direction',dir, ...
                                   'dx',dx, ...
                                   'arrangement',arr);
                        % combined flash and moving bars
                        r.conditions(end+(1:nLocs)) = ...
                            struct('isFlash',1, ...
                                   'isMoving',1, ...
                                   'isStop',0, ...
                                   'flashLocation',mat2cell(1:nLocs,1,ones(1,nLocs)), ...
                                   'barColor',r.barColor(:,i), ...
                                   'trajectoryAngle',angle, ...
                                   'direction',dir, ...
                                   'dx',dx, ...
                                   'arrangement',arr);

                        % flash-stop condition
                        if r.flashStop
                            r.conditions(end+1) = ...
                                struct('isFlash',0, ...
                                       'isMoving',1, ...
                                       'isStop',1, ...
                                       'flashLocation',NaN, ...
                                       'barColor',r.barColor(:,i), ...
                                       'trajectoryAngle',angle, ...
                                       'direction',dir, ...
                                       'dx',dx, ...
                                       'arrangement',arr);
                            r.conditions(end+(1:nLocs)) = ...
                                struct('isFlash',1, ...
                                       'isMoving',1, ...
                                       'isStop',1, ...
                                       'flashLocation',mat2cell(1:nLocs,1,ones(1,nLocs)), ...
                                       'barColor',r.barColor(:,i), ...
                                       'trajectoryAngle',angle, ...
                                       'direction',dir, ...
                                       'dx',dx, ...
                                       'arrangement',arr);
                        end
                    end
                end
            end
        end
    end
end

% initialize WhiteNoiseRandomization on condition indices
r.white = init(WhiteNoiseRandomization,1:length(r.conditions));
